<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Controle de Aluguéis</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .menu {
      margin-bottom: 20px;
    }
    .menu button {
      padding: 10px 20px;
      margin-right: 10px;
      border-radius: 8px;
      border: none;
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }
    .menu button:hover {
      background-color: #0056b3;
    }
    .section {
      display: none;
    }
    .section.active {
      display: block;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    .actions {
      margin-top: 10px;
    }
    .actions button {
      margin-right: 10px;
      padding: 6px 12px;
      border-radius: 5px;
      background-color: #dc3545;
      color: white;
      border: none;
      cursor: pointer;
    }
    .actions button:hover {
      background-color: #c82333;
    }
  </style>
</head>
<body>

  <div class="menu">
    <button onclick="toggleSection('alugueis')">Aluguéis</button>
    <button onclick="toggleSection('financeiro')">Financeiro</button>
  </div>

  <div id="alugueis" class="section active">
    <h2>Cadastro de Aluguéis</h2>
    <input type="text" id="nomeCliente" placeholder="Nome do Cliente"><br><br>
    <input type="text" id="cpfCliente" placeholder="CPF"><br><br>
    <input type="text" id="produto" placeholder="Produto alugado"><br><br>
    <input type="number" id="valor" placeholder="Valor"><br><br>
    <button onclick="salvarAluguel()">Salvar</button>

    <div class="actions">
      <button onclick="limparAlugueis()">Limpar Todos os Aluguéis</button>
    </div>

    <h3>Registros</h3>
    <table id="tabelaAlugueis">
      <thead>
        <tr>
          <th>Cliente</th>
          <th>CPF</th>
          <th>Produto</th>
          <th>Valor</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="financeiro" class="section">
    <h2>Controle Financeiro</h2>
    <select id="tipoFinanceiro">
      <option value="">Tipo</option>
      <option value="entrada">Entrada</option>
      <option value="saida">Saída</option>
    </select><br><br>
    <input type="text" id="nomeFinanceiro" placeholder="Nome"><br><br>
    <input type="number" id="valorFinanceiro" placeholder="Valor"><br><br>
    <input type="date" id="dataFinanceiro"><br><br>
    <input type="text" id="descricao" placeholder="Descrição (opcional)"><br><br>
    <button onclick="salvarFinanceiro()">Salvar</button>

    <div class="actions">
      <button onclick="limparFinanceiro()">Limpar Financeiro</button>
    </div>

    <h3>Resumo</h3>
    <div id="resumoFinanceiro"></div>

    <h3>Filtrar por Período</h3>
    <input type="date" id="dataInicio">
    <input type="date" id="dataFim">
    <button onclick="filtrarPeriodo()">Filtrar</button>
    <button onclick="limparFiltro()">Limpar Filtro</button>

    <h3>Movimentações</h3>
    <table id="tabelaFinanceiro">
      <thead>
        <tr>
          <th>Tipo</th>
          <th>Nome</th>
          <th>Data</th>
          <th>Valor</th>
          <th>Descrição</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script type="module">
    // Firebase config
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy, where } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_AUTH_DOMAIN",
      projectId: "SEU_PROJECT_ID",
      storageBucket: "SEU_STORAGE_BUCKET",
      messagingSenderId: "SEU_MESSAGING_ID",
      appId: "SEU_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    function toggleSection(id) {
      document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    async function salvarAluguel() {
      const nome = document.getElementById('nomeCliente').value.trim();
      const cpf = document.getElementById('cpfCliente').value.trim();
      const produto = document.getElementById('produto').value.trim();
      const valor = parseFloat(document.getElementById('valor').value);

      if (!nome || !cpf || !produto || isNaN(valor)) {
        alert('Preencha todos os campos corretamente!');
        return;
      }

      await addDoc(collection(db, 'aluguels'), { nome, cpf, produto, valor });
      alert('Aluguel salvo!');
      document.getElementById('nomeCliente').value = '';
      document.getElementById('cpfCliente').value = '';
      document.getElementById('produto').value = '';
      document.getElementById('valor').value = '';
      carregarAlugueis();
    }

    async function carregarAlugueis() {
      const snapshot = await getDocs(collection(db, 'aluguels'));
      const tbody = document.querySelector('#tabelaAlugueis tbody');
      tbody.innerHTML = '';
      snapshot.forEach(doc => {
        const d = doc.data();
        tbody.innerHTML += `
          <tr>
            <td>${d.nome}</td>
            <td>${d.cpf}</td>
            <td>${d.produto}</td>
            <td>R$ ${d.valor.toFixed(2)}</td>
          </tr>
        `;
      });
    }

    async function limparAlugueis() {
      if (!confirm("Tem certeza que deseja apagar todos os registros de aluguéis?")) return;
      const snapshot = await getDocs(collection(db, 'aluguels'));
      snapshot.forEach(async (d) => await deleteDoc(doc(db, 'aluguels', d.id)));
      alert("Registros de aluguel apagados.");
      carregarAlugueis();
    }

    async function salvarFinanceiro() {
      const tipo = document.getElementById('tipoFinanceiro').value;
      const nome = document.getElementById('nomeFinanceiro').value.trim();
      const valor = parseFloat(document.getElementById('valorFinanceiro').value);
      const data = document.getElementById('dataFinanceiro').value;
      const descricao = document.getElementById('descricao').value.trim();

      if (!tipo || !nome || isNaN(valor) || !data) {
        alert('Preencha todos os campos obrigatórios!');
        return;
      }

      await addDoc(collection(db, 'financeiro'), {
        tipo, nome, valor, data, descricao,
        timestamp: new Date(data).getTime()
      });

      alert('Movimentação salva!');
      document.getElementById('tipoFinanceiro').value = '';
      document.getElementById('nomeFinanceiro').value = '';
      document.getElementById('valorFinanceiro').value = '';
      document.getElementById('dataFinanceiro').value = '';
      document.getElementById('descricao').value = '';
      carregarMovimentacoes();
    }

    async function carregarMovimentacoes(filtroInicio, filtroFim) {
      const tbody = document.querySelector('#tabelaFinanceiro tbody');
      tbody.innerHTML = '<tr><td colspan="5">Carregando...</td></tr>';

      let q = query(collection(db, 'financeiro'), orderBy('timestamp', 'desc'));
      if (filtroInicio) q = query(q, where('timestamp', '>=', filtroInicio.getTime()));
      if (filtroFim) q = query(q, where('timestamp', '<=', filtroFim.getTime()));

      const snapshot = await getDocs(q);
      const dados = [];
      let html = '';

      snapshot.forEach(doc => {
        const d = doc.data();
        dados.push(d);
        html += `<tr>
          <td>${d.tipo === 'entrada' ? 'Entrada' : 'Saída'}</td>
          <td>${d.nome}</td>
          <td>${new Date(d.data).toLocaleDateString()}</td>
          <td>R$ ${d.valor.toFixed(2)}</td>
          <td>${d.descricao || ''}</td>
        </tr>`;
      });

      tbody.innerHTML = html || '<tr><td colspan="5">Nenhuma movimentação encontrada.</td></tr>';
      atualizarResumo(dados);
    }

    function atualizarResumo(dados) {
      let totalEntradas = 0, totalSaidas = 0;
      dados.forEach(d => {
        if (d.tipo === 'entrada') totalEntradas += d.valor;
        else totalSaidas += d.valor;
      });
      const saldo = totalEntradas - totalSaidas;
      document.getElementById('resumoFinanceiro').textContent =
        `Total Entradas: R$ ${totalEntradas.toFixed(2)} | Total Saídas: R$ ${totalSaidas.toFixed(2)} | Saldo: R$ ${saldo.toFixed(2)}`;
    }

    async function limparFinanceiro() {
      if (!confirm("Tem certeza que deseja apagar TODO o controle financeiro?")) return;
      const snapshot = await getDocs(collection(db, 'financeiro'));
      snapshot.forEach(async (d) => await deleteDoc(doc(db, 'financeiro', d.id)));
      alert("Controle financeiro apagado.");
      carregarMovimentacoes();
    }

    function filtrarPeriodo() {
      const inicio = document.getElementById('dataInicio').value;
      const fim = document.getElementById('dataFim').value;
      const d1 = inicio ? new Date(inicio) : null;
      const d2 = fim ? new Date(fim) : null;

      if (d1 && d2 && d1 > d2) {
        alert('Data início não pode ser maior que a data fim!');
        return;
      }

      carregarMovimentacoes(d1, d2);
    }

    function limparFiltro() {
      document.getElementById('dataInicio').value = '';
      document.getElementById('dataFim').value = '';
      carregarMovimentacoes();
    }

    // Inicializa
    carregarAlugueis();
    carregarMovimentacoes();
  </script>

</body>
</html>
